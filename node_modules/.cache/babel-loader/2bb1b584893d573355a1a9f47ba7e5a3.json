{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/xiaxiaoyu/Desktop/javascript/DBSM_phone/PHONE_STORE_FE/src/components/PaymentForm.jsx\",\n    _s = $RefreshSig$();\n\nimport { v4 as uuidv4 } from \"uuid\";\nimport { Button, Card, HelperText } from \"@windmill/react-ui\";\nimport { useCart } from \"context/CartContext\";\nimport toast from \"react-hot-toast\";\nimport { formatCurrency } from \"helpers/formatCurrency\";\nimport React, { useState } from \"react\";\nimport { useHistory } from \"react-router\";\nimport OrderService from \"services/order.service\";\nimport OrderSummary from \"./OrderSummary\";\n\nconst PaymentForm = ({\n  previousStep,\n  addressData,\n  nextStep\n}) => {\n  _s();\n\n  const {\n    cartSubtotal,\n    cartTotal,\n    cartData,\n    setCartData\n  } = useCart();\n  const [error, setError] = useState();\n  const [isProcessing, setIsProcessing] = useState(false); // const stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUB_KEY);\n\n  const history = useHistory();\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setError();\n\n    try {\n      setIsProcessing(true);\n      const {\n        fullname,\n        email,\n        address,\n        city,\n        state\n      } = addressData; // Mock payment\n\n      const data = {\n        id: uuidv4(),\n        amount: (cartSubtotal * 100).toFixed(),\n        billing_details: {\n          name: fullname,\n          email,\n          address: {\n            city,\n            line1: address,\n            state,\n            country: \"NG\" // TODO: change later\n\n          }\n        }\n      };\n      let shoppingList = {};\n\n      if (cartData.items) {\n        cartData.items.forEach((item, index) => {\n          const id = item.product_id;\n          const inventory = item.quantity;\n          shoppingList[id] = inventory;\n        });\n      }\n\n      debugger;\n      OrderService.createOrder(cartSubtotal, cartTotal, data.id, \"STRIPE\", shoppingList).then(() => {\n        setCartData({ ...cartData,\n          items: []\n        });\n        setIsProcessing(false);\n        toast.success(\"Successfully paied\");\n        history.push({\n          pathname: \"/cart/success\",\n          state: {\n            fromPaymentPage: true\n          }\n        });\n      });\n    } catch (error) {\n      debugger;\n      setIsProcessing(false);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full md:w-1/2\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-3xl font-semibold text-center mb-2\",\n      children: \"Checkout\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(OrderSummary, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      disabled: isProcessing,\n      onClick: handleSubmit,\n      className: \"w-full\",\n      children: [\"Pay $\", formatCurrency(cartSubtotal)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 3\n  }, this);\n};\n\n_s(PaymentForm, \"CJspq1BLbpmcU+45cGGpaLEykTw=\", false, function () {\n  return [useCart, useHistory];\n});\n\n_c = PaymentForm;\nexport default PaymentForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentForm\");","map":{"version":3,"sources":["/Users/xiaxiaoyu/Desktop/javascript/DBSM_phone/PHONE_STORE_FE/src/components/PaymentForm.jsx"],"names":["v4","uuidv4","Button","Card","HelperText","useCart","toast","formatCurrency","React","useState","useHistory","OrderService","OrderSummary","PaymentForm","previousStep","addressData","nextStep","cartSubtotal","cartTotal","cartData","setCartData","error","setError","isProcessing","setIsProcessing","history","handleSubmit","e","preventDefault","fullname","email","address","city","state","data","id","amount","toFixed","billing_details","name","line1","country","shoppingList","items","forEach","item","index","product_id","inventory","quantity","createOrder","then","success","push","pathname","fromPaymentPage"],"mappings":";;;;;AAAA,SAASA,EAAE,IAAIC,MAAf,QAA6B,MAA7B;AACA,SAASC,MAAT,EAAiBC,IAAjB,EAAuBC,UAAvB,QAAyC,oBAAzC;AACA,SAASC,OAAT,QAAwB,qBAAxB;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AACA,SAASC,cAAT,QAA+B,wBAA/B;AACA,OAAOC,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;AACA,SAASC,UAAT,QAA2B,cAA3B;AACA,OAAOC,YAAP,MAAyB,wBAAzB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;;AAEA,MAAMC,WAAW,GAAG,CAAC;AAAEC,EAAAA,YAAF;AAAgBC,EAAAA,WAAhB;AAA6BC,EAAAA;AAA7B,CAAD,KAA6C;AAAA;;AAChE,QAAM;AAAEC,IAAAA,YAAF;AAAgBC,IAAAA,SAAhB;AAA2BC,IAAAA,QAA3B;AAAqCC,IAAAA;AAArC,MAAqDf,OAAO,EAAlE;AACA,QAAM,CAACgB,KAAD,EAAQC,QAAR,IAAoBb,QAAQ,EAAlC;AACA,QAAM,CAACc,YAAD,EAAeC,eAAf,IAAkCf,QAAQ,CAAC,KAAD,CAAhD,CAHgE,CAIhE;;AACA,QAAMgB,OAAO,GAAGf,UAAU,EAA1B;;AAEA,QAAMgB,YAAY,GAAG,MAAOC,CAAP,IAAa;AACjCA,IAAAA,CAAC,CAACC,cAAF;AACAN,IAAAA,QAAQ;;AACR,QAAI;AACHE,MAAAA,eAAe,CAAC,IAAD,CAAf;AACA,YAAM;AAAEK,QAAAA,QAAF;AAAYC,QAAAA,KAAZ;AAAmBC,QAAAA,OAAnB;AAA4BC,QAAAA,IAA5B;AAAkCC,QAAAA;AAAlC,UAA4ClB,WAAlD,CAFG,CAIH;;AACA,YAAMmB,IAAI,GAAG;AACZC,QAAAA,EAAE,EAAElC,MAAM,EADE;AAEZmC,QAAAA,MAAM,EAAE,CAACnB,YAAY,GAAG,GAAhB,EAAqBoB,OAArB,EAFI;AAGZC,QAAAA,eAAe,EAAE;AAChBC,UAAAA,IAAI,EAAEV,QADU;AAEhBC,UAAAA,KAFgB;AAGhBC,UAAAA,OAAO,EAAE;AACRC,YAAAA,IADQ;AAERQ,YAAAA,KAAK,EAAET,OAFC;AAGRE,YAAAA,KAHQ;AAIRQ,YAAAA,OAAO,EAAE,IAJD,CAIO;;AAJP;AAHO;AAHL,OAAb;AAeA,UAAIC,YAAY,GAAG,EAAnB;;AACA,UAAIvB,QAAQ,CAACwB,KAAb,EAAoB;AACnBxB,QAAAA,QAAQ,CAACwB,KAAT,CAAeC,OAAf,CAAuB,CAACC,IAAD,EAAOC,KAAP,KAAiB;AACvC,gBAAMX,EAAE,GAAGU,IAAI,CAACE,UAAhB;AACA,gBAAMC,SAAS,GAAGH,IAAI,CAACI,QAAvB;AACAP,UAAAA,YAAY,CAACP,EAAD,CAAZ,GAAmBa,SAAnB;AACA,SAJD;AAKA;;AAED;AAEArC,MAAAA,YAAY,CAACuC,WAAb,CACCjC,YADD,EAECC,SAFD,EAGCgB,IAAI,CAACC,EAHN,EAIC,QAJD,EAKCO,YALD,EAMES,IANF,CAMO,MAAM;AACZ/B,QAAAA,WAAW,CAAC,EAAE,GAAGD,QAAL;AAAewB,UAAAA,KAAK,EAAE;AAAtB,SAAD,CAAX;AACAnB,QAAAA,eAAe,CAAC,KAAD,CAAf;AACAlB,QAAAA,KAAK,CAAC8C,OAAN,CAAc,oBAAd;AACA3B,QAAAA,OAAO,CAAC4B,IAAR,CAAa;AACZC,UAAAA,QAAQ,EAAE,eADE;AAEZrB,UAAAA,KAAK,EAAE;AACNsB,YAAAA,eAAe,EAAE;AADX;AAFK,SAAb;AAMA,OAhBD;AAiBA,KAhDD,CAgDE,OAAOlC,KAAP,EAAc;AACf;AACAG,MAAAA,eAAe,CAAC,KAAD,CAAf;AACA;AACD,GAvDD;;AAyDA,sBACC;AAAK,IAAA,SAAS,EAAC,iBAAf;AAAA,4BACC;AAAI,MAAA,SAAS,EAAC,yCAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADD,eAEC,QAAC,YAAD;AAAA;AAAA;AAAA;AAAA,YAFD,eAGC,QAAC,MAAD;AAAQ,MAAA,QAAQ,EAAED,YAAlB;AAAgC,MAAA,OAAO,EAAEG,YAAzC;AAAuD,MAAA,SAAS,EAAC,QAAjE;AAAA,0BACOnB,cAAc,CAACU,YAAD,CADrB;AAAA;AAAA;AAAA;AAAA;AAAA,YAHD;AAAA;AAAA;AAAA;AAAA;AAAA,UADD;AASA,CAzED;;GAAMJ,W;UACsDR,O,EAI3CK,U;;;KALXG,W;AA2EN,eAAeA,WAAf","sourcesContent":["import { v4 as uuidv4 } from \"uuid\";\nimport { Button, Card, HelperText } from \"@windmill/react-ui\";\nimport { useCart } from \"context/CartContext\";\nimport toast from \"react-hot-toast\";\nimport { formatCurrency } from \"helpers/formatCurrency\";\nimport React, { useState } from \"react\";\nimport { useHistory } from \"react-router\";\nimport OrderService from \"services/order.service\";\nimport OrderSummary from \"./OrderSummary\";\n\nconst PaymentForm = ({ previousStep, addressData, nextStep }) => {\n\tconst { cartSubtotal, cartTotal, cartData, setCartData } = useCart();\n\tconst [error, setError] = useState();\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\t// const stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUB_KEY);\n\tconst history = useHistory();\n\n\tconst handleSubmit = async (e) => {\n\t\te.preventDefault();\n\t\tsetError();\n\t\ttry {\n\t\t\tsetIsProcessing(true);\n\t\t\tconst { fullname, email, address, city, state } = addressData;\n\n\t\t\t// Mock payment\n\t\t\tconst data = {\n\t\t\t\tid: uuidv4(),\n\t\t\t\tamount: (cartSubtotal * 100).toFixed(),\n\t\t\t\tbilling_details: {\n\t\t\t\t\tname: fullname,\n\t\t\t\t\temail,\n\t\t\t\t\taddress: {\n\t\t\t\t\t\tcity,\n\t\t\t\t\t\tline1: address,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tcountry: \"NG\", // TODO: change later\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tlet shoppingList = {};\n\t\t\tif (cartData.items) {\n\t\t\t\tcartData.items.forEach((item, index) => {\n\t\t\t\t\tconst id = item.product_id;\n\t\t\t\t\tconst inventory = item.quantity;\n\t\t\t\t\tshoppingList[id] = inventory;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdebugger;\n\n\t\t\tOrderService.createOrder(\n\t\t\t\tcartSubtotal,\n\t\t\t\tcartTotal,\n\t\t\t\tdata.id,\n\t\t\t\t\"STRIPE\",\n\t\t\t\tshoppingList\n\t\t\t).then(() => {\n\t\t\t\tsetCartData({ ...cartData, items: [] });\n\t\t\t\tsetIsProcessing(false);\n\t\t\t\ttoast.success(\"Successfully paied\");\n\t\t\t\thistory.push({\n\t\t\t\t\tpathname: \"/cart/success\",\n\t\t\t\t\tstate: {\n\t\t\t\t\t\tfromPaymentPage: true,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdebugger;\n\t\t\tsetIsProcessing(false);\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"w-full md:w-1/2\">\n\t\t\t<h1 className=\"text-3xl font-semibold text-center mb-2\">Checkout</h1>\n\t\t\t<OrderSummary />\n\t\t\t<Button disabled={isProcessing} onClick={handleSubmit} className=\"w-full\">\n\t\t\t\tPay ${formatCurrency(cartSubtotal)}\n\t\t\t</Button>\n\t\t</div>\n\t);\n};\n\nexport default PaymentForm;\n"]},"metadata":{},"sourceType":"module"}